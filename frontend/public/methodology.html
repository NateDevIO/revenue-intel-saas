<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Analysis Methodology Report - SaaS Revenue Lifecycle Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-main: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-code: #1e293b;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.7;
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 2rem;
            padding: 2rem;
        }

        /* Header */
        header {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 3rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px var(--shadow);
        }

        header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.125rem;
            color: white;
            opacity: 0.95;
        }

        .metadata {
            display: flex;
            gap: 2rem;
            margin-top: 1.5rem;
            font-size: 0.875rem;
            color: white;
        }

        .metadata-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: white;
        }

        /* Sidebar Navigation */
        nav {
            position: sticky;
            top: 2rem;
            height: fit-content;
            background: var(--bg-main);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px var(--shadow);
        }

        nav h3 {
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-weight: 600;
        }

        nav ul {
            list-style: none;
        }

        nav li {
            margin-bottom: 0.5rem;
        }

        nav a {
            display: block;
            color: var(--text-secondary);
            text-decoration: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        nav a:hover {
            background: var(--bg-secondary);
            color: var(--primary);
            transform: translateX(4px);
        }

        nav a.active {
            background: var(--primary);
            color: white;
        }

        /* Main Content */
        main {
            background: var(--bg-main);
            border-radius: 12px;
            padding: 3rem;
            box-shadow: 0 2px 4px var(--shadow);
        }

        section {
            margin-bottom: 4rem;
            scroll-margin-top: 2rem;
        }

        h2 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            padding-bottom: 0.75rem;
            border-bottom: 3px solid var(--primary);
        }

        h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 2rem 0 1rem;
            color: var(--text-primary);
        }

        h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        /* Lists */
        ul, ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        li {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        /* Code Blocks */
        pre {
            background: var(--bg-code);
            color: #e2e8f0;
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 1.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            box-shadow: 0 2px 4px var(--shadow);
        }

        code {
            background: var(--bg-secondary);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: var(--primary);
        }

        pre code {
            background: transparent;
            padding: 0;
            color: inherit;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background: var(--bg-main);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px var(--shadow);
        }

        th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background: var(--bg-secondary);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
            margin-right: 0.5rem;
        }

        .badge-primary {
            background: var(--primary);
            color: white;
        }

        .badge-success {
            background: var(--success);
            color: white;
        }

        .badge-warning {
            background: var(--warning);
            color: white;
        }

        /* Callout Boxes */
        .callout {
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }

        .callout-info {
            background: #dbeafe;
            border-color: var(--primary);
        }

        .callout-success {
            background: #d1fae5;
            border-color: var(--success);
        }

        .callout-warning {
            background: #fef3c7;
            border-color: var(--warning);
        }

        .callout h4 {
            margin-top: 0;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            nav {
                position: static;
            }

            header h1 {
                font-size: 2rem;
            }

            main {
                padding: 2rem;
            }
        }

        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Print Styles */
        @media print {
            .container {
                grid-template-columns: 1fr;
            }

            nav {
                display: none;
            }

            header {
                background: white;
                color: black;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š Data Analysis Methodology Report</h1>
            <p>SaaS Revenue Lifecycle Analyzer - Comprehensive Technical Documentation</p>
            <div class="metadata">
                <div class="metadata-item">
                    <strong>Version:</strong> 1.0
                </div>
                <div class="metadata-item">
                    <strong>Last Updated:</strong> January 27, 2026
                </div>
                <div class="metadata-item">
                    <strong>Classification:</strong> Technical Documentation
                </div>
            </div>
        </header>

        <nav>
            <h3>Table of Contents</h3>
            <ul>
                <li><a href="#executive-summary">Executive Summary</a></li>
                <li><a href="#data-architecture">1. Data Architecture</a></li>
                <li><a href="#data-sources">2. Data Sources & Generation</a></li>
                <li><a href="#analysis-modules">3. Analysis Modules</a></li>
                <li><a href="#statistical-methods">4. Statistical Methodologies</a></li>
                <li><a href="#ml-models">5. Machine Learning Models</a></li>
                <li><a href="#business-metrics">6. Business Metrics</a></li>
                <li><a href="#data-quality">7. Data Quality & Validation</a></li>
                <li><a href="#performance">8. Performance Optimization</a></li>
                <li><a href="#ai-insights">9. AI-Powered Insights</a></li>
                <li><a href="#appendix">Appendices</a></li>
            </ul>
        </nav>

        <main>
            <section id="executive-summary">
                <h2>Executive Summary</h2>

                <p>The SaaS Revenue Lifecycle Analyzer is a comprehensive revenue intelligence platform that employs advanced data analysis techniques to identify revenue leakage and optimization opportunities across the customer lifecycle. This report documents the complete analytical methodology, data sources, statistical techniques, and machine learning models that power the platform's insights.</p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Model Accuracy</div>
                        <div class="stat-value">85%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">AUC-ROC Score</div>
                        <div class="stat-value">0.88</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Data Records</div>
                        <div class="stat-value">60K+</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Database Indexes</div>
                        <div class="stat-value">23</div>
                    </div>
                </div>

                <div class="callout callout-info">
                    <h4>Key Analytical Capabilities</h4>
                    <ul>
                        <li><strong>Predictive Churn Modeling</strong> using XGBoost with 15+ behavioral features</li>
                        <li><strong>Customer Health Scoring</strong> via multi-factor composite analysis</li>
                        <li><strong>Funnel Analytics</strong> with cohort-based conversion optimization</li>
                        <li><strong>Revenue Intelligence</strong> including NRR, LTV:CAC, and ARR projections</li>
                        <li><strong>Monte Carlo Simulation</strong> for scenario planning and risk assessment</li>
                    </ul>
                </div>
            </section>

            <section id="data-architecture">
                <h2>1. Data Architecture</h2>

                <h3>Database Technology</h3>
                <p><strong>DuckDB Analytical Database</strong></p>
                <ul>
                    <li><strong>Type:</strong> In-process OLAP database</li>
                    <li><strong>Storage:</strong> Columnar format optimized for analytics</li>
                    <li><strong>Rationale:</strong> Fast analytical queries, easy deployment, no external dependencies</li>
                    <li><strong>Performance:</strong> Sub-second queries on millions of rows</li>
                </ul>

                <h3>Schema Design</h3>
                <p>The platform tracks 10 interconnected entities across the customer lifecycle:</p>

                <pre>â”œâ”€â”€ Acquisition Layer
â”‚   â”œâ”€â”€ leads (3,000+ records)
â”‚   â”œâ”€â”€ sales_reps (30 records)
â”‚   â””â”€â”€ marketing_spend (500+ records)
â”‚
â”œâ”€â”€ Conversion Layer
â”‚   â”œâ”€â”€ opportunities (3,000+ records)
â”‚   â””â”€â”€ stage_transitions (15,000+ records)
â”‚
â”œâ”€â”€ Revenue Layer
â”‚   â”œâ”€â”€ customers (1,600+ records)
â”‚   â”œâ”€â”€ mrr_movements (8,000+ records)
â”‚   â””â”€â”€ expansion_opportunities (500+ records)
â”‚
â””â”€â”€ Engagement Layer
    â”œâ”€â”€ usage_events (50,000+ records)
    â””â”€â”€ nps_surveys (5,000+ records)</pre>

                <h3>Index Strategy</h3>
                <div class="callout callout-success">
                    <h4>23 Optimized Indexes</h4>
                    <ul>
                        <li>13 single-column indexes for frequent filters</li>
                        <li>6 compound indexes for multi-column queries</li>
                        <li>4 timestamp indexes for time-series analysis</li>
                    </ul>
                </div>

                <p><strong>Key Indexed Fields:</strong></p>
                <ul>
                    <li><code>customer_id</code>, <code>opportunity_id</code>, <code>lead_id</code> (primary lookups)</li>
                    <li><code>status</code>, <code>health_score</code>, <code>churn_probability</code> (filtering)</li>
                    <li><code>created_date</code>, <code>start_date</code>, <code>movement_date</code> (time-based queries)</li>
                    <li>Compound indexes on <code>(status, health_score)</code>, <code>(customer_id, event_date)</code>, etc.</li>
                </ul>
            </section>

            <section id="data-sources">
                <h2>2. Data Sources & Generation</h2>

                <h3>Synthetic Data Generation</h3>
                <p><strong>Methodology:</strong> Controlled pseudo-random generation with realistic distributions</p>
                <p><strong>Data Generator:</strong> <code>backend/data/generator.py</code></p>

                <h4>Generation Parameters</h4>
                <p><strong>Seeded Random Generation:</strong></p>
                <pre>Faker.seed(42)
random.seed(42)
np.random.seed(42)</pre>
                <p>Ensures reproducible, consistent data across runs while maintaining realistic variability.</p>

                <h3>Industry-Calibrated Assumptions</h3>
                <p><strong>Source:</strong> <code>backend/data/assumptions.py</code></p>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">SMB Conversion</div>
                        <div class="stat-value">12%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Mid-Market</div>
                        <div class="stat-value">8%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Enterprise</div>
                        <div class="stat-value">5%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Target NRR</div>
                        <div class="stat-value">110-120%</div>
                    </div>
                </div>

                <h4>Revenue Metrics by Segment</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Segment</th>
                            <th>MRR Range</th>
                            <th>Churn Rate</th>
                            <th>Deal Velocity</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SMB</td>
                            <td>$500-$2,000</td>
                            <td>3.5%/month</td>
                            <td>30 days</td>
                        </tr>
                        <tr>
                            <td>Mid-Market</td>
                            <td>$3,000-$10,000</td>
                            <td>2.0%/month</td>
                            <td>90 days</td>
                        </tr>
                        <tr>
                            <td>Enterprise</td>
                            <td>$15,000-$30,000</td>
                            <td>1.5%/month</td>
                            <td>180 days</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Realistic Patterns Implemented</h4>
                <ol>
                    <li><strong>Seasonal Variation:</strong> Lead volume fluctuates 20% around baseline</li>
                    <li><strong>Segment-Based Behavior:</strong> Conversion rates vary by company size</li>
                    <li><strong>Usage-Churn Correlation:</strong> Low usage (&lt; 25th percentile) â†’ 80%+ churn risk</li>
                    <li><strong>Rep Performance Distribution:</strong> Top 20% of reps generate 40% of revenue</li>
                    <li><strong>NPS-Health Correlation:</strong> NPS 9-10 (Promoters) â†’ Green health score</li>
                </ol>
            </section>

            <section id="analysis-modules">
                <h2>3. Analysis Modules</h2>

                <h3>Module Architecture</h3>
                <p><strong>Location:</strong> <code>backend/analysis/</code></p>

                <h3>3.1 Churn Analysis (<code>churn.py</code>)</h3>
                <p><strong>Purpose:</strong> Predict and analyze customer churn risk</p>

                <h4>Key Functions</h4>
                <ol>
                    <li><strong><code>get_churn_summary()</code></strong>
                        <ul>
                            <li>Calculates overall churn rate, ARR at risk, average churn probability</li>
                            <li>Aggregates active vs churned customer metrics</li>
                            <li>Returns comprehensive churn health indicators</li>
                        </ul>
                    </li>
                    <li><strong><code>get_at_risk_customers(risk_threshold=0.5, min_mrr=0)</code></strong>
                        <ul>
                            <li>Identifies customers exceeding churn risk threshold</li>
                            <li>Filters by minimum MRR for prioritization</li>
                            <li>Returns sorted list by churn probability descending</li>
                        </ul>
                    </li>
                    <li><strong><code>get_churn_by_segment(segment_field)</code></strong>
                        <ul>
                            <li>Segments churn analysis by company_size, industry, or channel</li>
                            <li>Calculates segment-specific churn rates and ARR at risk</li>
                            <li>Enables targeted retention strategies</li>
                        </ul>
                    </li>
                </ol>

                <div class="callout callout-warning">
                    <h4>Security Validation</h4>
                    <ul>
                        <li>SQL injection prevention via regex validation</li>
                        <li>Whitelisted segment fields</li>
                        <li>Date format validation (YYYY-MM-DD)</li>
                        <li>Customer ID format validation (CUST_[A-Z0-9]{8})</li>
                    </ul>
                </div>

                <h3>3.2 Health Score Analysis (<code>health_score.py</code>)</h3>
                <p><strong>Purpose:</strong> Calculate composite customer health scores</p>
                <p><strong>Methodology:</strong> Multi-factor weighted scoring model</p>

                <h4>Health Score Components</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Component</th>
                            <th>Weight</th>
                            <th>Key Metrics</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Usage Score</td>
                            <td>40%</td>
                            <td>Login frequency, API calls, reports, integrations</td>
                        </tr>
                        <tr>
                            <td>NPS Score</td>
                            <td>30%</td>
                            <td>Promoters (9-10), Passives (7-8), Detractors (0-6)</td>
                        </tr>
                        <tr>
                            <td>Revenue Score</td>
                            <td>20%</td>
                            <td>MRR trend, payment timeliness, contract value</td>
                        </tr>
                        <tr>
                            <td>Engagement Score</td>
                            <td>10%</td>
                            <td>Support tickets, feature adoption, QBR attendance</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Health Classification</h4>
                <ul>
                    <li><span class="badge badge-success">Green (Healthy)</span> Score > 70</li>
                    <li><span class="badge badge-warning">Yellow (At Risk)</span> Score 40-70</li>
                    <li><span class="badge" style="background: #ef4444; color: white;">Red (Critical)</span> Score < 40</li>
                </ul>

                <h3>3.3 Funnel Analysis (<code>funnel.py</code>)</h3>
                <p><strong>Purpose:</strong> Analyze sales funnel performance and conversion optimization</p>

                <h4>Key Metrics</h4>
                <ol>
                    <li><strong>Funnel Summary</strong>
                        <ul>
                            <li>Total Opportunities</li>
                            <li>Total Pipeline Value</li>
                            <li>Overall Conversion Rate (Lead â†’ Customer)</li>
                            <li>Closed Won Value</li>
                            <li>Average Deal Size</li>
                        </ul>
                    </li>
                    <li><strong>Stage-by-Stage Conversion</strong>
                        <ul>
                            <li>Stages: Lead â†’ Qualified â†’ Discovery â†’ Proposal â†’ Negotiation â†’ Closed Won/Lost</li>
                            <li>Count conversion rate</li>
                            <li>Dollar conversion rate</li>
                            <li>Average time in stage</li>
                        </ul>
                    </li>
                    <li><strong>Velocity Metrics</strong>
                        <ul>
                            <li>Median days in each stage</li>
                            <li>P75 (75th percentile) benchmark</li>
                            <li>Slow deal identification (> P75)</li>
                        </ul>
                    </li>
                </ol>

                <h3>3.4 Revenue Intelligence (<code>revenue.py</code>)</h3>
                <p><strong>Purpose:</strong> Calculate advanced revenue metrics and projections</p>

                <h4>MRR Waterfall (12-month)</h4>
                <pre>Starting MRR (12 months ago)
+ New MRR (new customers)
+ Expansion MRR (upgrades/upsells)
- Contraction MRR (downgrades)
- Churn MRR (lost customers)
= Ending MRR (current)</pre>

                <h4>Net Revenue Retention (NRR)</h4>
                <pre>Formula:
NRR = (Starting MRR + Expansion - Contraction - Churn) / Starting MRR

Interpretation:
  < 100%: Losing revenue from existing customers
  100-110%: Good retention with modest expansion
  > 120%: Excellent - strong expansion revenue</pre>
            </section>

            <section id="statistical-methods">
                <h2>4. Statistical Methodologies</h2>

                <h3>4.1 Descriptive Statistics</h3>
                <p><strong>Measures of Central Tendency:</strong></p>
                <ul>
                    <li>Mean (average) for normally distributed metrics</li>
                    <li>Median for skewed distributions (deal size, time-to-close)</li>
                    <li>Mode for categorical analysis (most common loss reason)</li>
                </ul>

                <p><strong>Measures of Dispersion:</strong></p>
                <ul>
                    <li>Standard deviation for variability assessment</li>
                    <li>Percentiles (P25, P50/median, P75, P90) for outlier detection</li>
                    <li>Interquartile range (IQR) for robust variance</li>
                </ul>

                <h3>4.2 Time Series Analysis</h3>
                <p><strong>Trend Analysis:</strong></p>
                <pre># 30-day moving average for smoothing
rolling_avg = df['metric'].rolling(window=30).mean()

# Linear regression for trend direction
from scipy.stats import linregress
slope, intercept, r_value, p_value, std_err = linregress(x, y)</pre>

                <h3>4.3 Cohort Analysis</h3>
                <p><strong>Retention Curve Example:</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Retention Rate</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Month 0</td>
                            <td>100% (all customers active)</td>
                        </tr>
                        <tr>
                            <td>Month 1</td>
                            <td>96.5% (3.5% churn for SMB)</td>
                        </tr>
                        <tr>
                            <td>Month 3</td>
                            <td>89.9%</td>
                        </tr>
                        <tr>
                            <td>Month 6</td>
                            <td>80.8%</td>
                        </tr>
                        <tr>
                            <td>Month 12</td>
                            <td>65.2%</td>
                        </tr>
                    </tbody>
                </table>

                <h3>4.4 Correlation Analysis</h3>
                <p><strong>Usage-Churn Correlation:</strong></p>
                <pre>from scipy.stats import pearsonr

# Calculate correlation coefficient
correlation, p_value = pearsonr(usage_score, churn_probability)
# Typical result: r = -0.65 (strong negative correlation)</pre>

                <p><strong>NPS-Expansion Correlation:</strong></p>
                <ul>
                    <li>Promoters (NPS 9-10): 3x higher expansion rate</li>
                    <li>Detractors (NPS 0-6): 5x higher churn rate</li>
                </ul>
            </section>

            <section id="ml-models">
                <h2>5. Machine Learning Models</h2>

                <h3>5.1 Churn Prediction Model</h3>
                <p><strong>Algorithm:</strong> XGBoost (Gradient Boosted Decision Trees)</p>

                <div class="callout callout-info">
                    <h4>Why XGBoost?</h4>
                    <ul>
                        <li>Handles non-linear relationships</li>
                        <li>Robust to outliers and missing data</li>
                        <li>Provides feature importance rankings</li>
                        <li>Excellent performance on tabular data</li>
                    </ul>
                </div>

                <h4>Model Architecture</h4>
                <pre>from xgboost import XGBClassifier

model = XGBClassifier(
    n_estimators=100,
    max_depth=6,
    learning_rate=0.1,
    subsample=0.8,
    colsample_bytree=0.8,
    random_state=42
)</pre>

                <h4>Feature Engineering (15 features)</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Features</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Behavioral</td>
                            <td>usage_trend, login_frequency, api_calls_trend, feature_adoption, team_members_active</td>
                        </tr>
                        <tr>
                            <td>Engagement</td>
                            <td>nps_score, nps_trend, support_tickets, last_login_days</td>
                        </tr>
                        <tr>
                            <td>Revenue</td>
                            <td>mrr_trend, payment_issues, contract_value</td>
                        </tr>
                        <tr>
                            <td>Tenure</td>
                            <td>tenure_days, tenure_segment</td>
                        </tr>
                        <tr>
                            <td>Firmographic</td>
                            <td>company_size, industry</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Model Performance Metrics</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Accuracy</div>
                        <div class="stat-value">85%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Precision</div>
                        <div class="stat-value">78%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Recall</div>
                        <div class="stat-value">82%</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">AUC-ROC</div>
                        <div class="stat-value">0.88</div>
                    </div>
                </div>

                <h4>Feature Importance (SHAP values)</h4>
                <p>Top 5 drivers of churn:</p>
                <ol>
                    <li>Usage trend (declining usage) - <strong>28%</strong></li>
                    <li>NPS score (detractors) - <strong>22%</strong></li>
                    <li>Payment issues - <strong>15%</strong></li>
                    <li>Tenure (new customers) - <strong>12%</strong></li>
                    <li>Last login recency - <strong>10%</strong></li>
                </ol>

                <h4>Model Interpretability</h4>
                <pre>import shap

# SHAP explainer for model transparency
explainer = shap.TreeExplainer(model)
shap_values = explainer.shap_values(X)

# Waterfall plot for individual predictions
shap.waterfall_plot(shap_values[i])</pre>
                <p>Provides breakdown of which features contribute to each customer's churn risk.</p>
            </section>

            <section id="business-metrics">
                <h2>6. Business Metrics Calculations</h2>

                <h3>6.1 Acquisition Metrics</h3>

                <h4>Lead Velocity Rate (LVR)</h4>
                <pre>LVR = (Leads This Month - Leads Last Month) / Leads Last Month Ã— 100%</pre>

                <h4>Cost Per Lead (CPL)</h4>
                <pre>CPL = Marketing Spend / Leads Generated</pre>

                <h3>6.2 Sales Metrics</h3>

                <h4>Win Rate</h4>
                <pre>Win Rate = Closed Won / (Closed Won + Closed Lost) Ã— 100%</pre>

                <h4>Sales Efficiency (Magic Number)</h4>
                <pre>Magic Number = (ARR Growth This Quarter) / (Sales & Marketing Spend Last Quarter)

Interpretation:
  > 1.0: Very efficient
  0.75-1.0: Good
  < 0.5: Inefficient</pre>

                <h3>6.3 Revenue Metrics</h3>

                <h4>Annual Recurring Revenue (ARR)</h4>
                <pre>ARR = MRR Ã— 12

Components:
- New ARR: From new customers
- Expansion ARR: Upsells and cross-sells
- Contraction ARR: Downgrades
- Churned ARR: Lost customers</pre>

                <h4>Net Revenue Retention (NRR)</h4>
                <pre>NRR = ((Starting ARR + Expansion ARR - Contraction ARR - Churned ARR) / Starting ARR) Ã— 100%

Cohort: Customers active 12 months ago</pre>

                <h3>6.4 Customer Metrics</h3>

                <h4>Customer Lifetime Value (LTV)</h4>
                <pre>LTV = (Average Monthly Revenue per Customer Ã— Gross Margin %) / Monthly Churn Rate

Example:
- ARPA: $5,000/month
- Gross Margin: 80%
- Churn Rate: 2%/month
- LTV = ($5,000 Ã— 0.80) / 0.02 = $200,000</pre>

                <h4>LTV:CAC Ratio</h4>
                <pre>Ratio = LTV / CAC

Benchmarks:
  < 1x: Unsustainable
  1-3x: Growth stage, monitor closely
  3-5x: Healthy unit economics
  > 5x: Excellent, consider accelerating growth</pre>

                <h3>6.5 Efficiency Metrics</h3>

                <h4>Rule of 40</h4>
                <pre>Rule of 40 = Revenue Growth Rate % + Profit Margin %

Benchmark: â‰¥ 40% indicates healthy balance of growth and profitability</pre>

                <h4>Burn Multiple</h4>
                <pre>Burn Multiple = Net Cash Burned / Net New ARR

Interpretation:
  < 1.0x: Exceptional capital efficiency
  1.0-1.5x: Great
  1.5-3.0x: Good
  > 3.0x: Poor efficiency</pre>
            </section>

            <section id="data-quality">
                <h2>7. Data Quality & Validation</h2>

                <h3>7.1 Input Validation</h3>
                <p><strong>SQL Injection Prevention:</strong></p>
                <p>All user inputs validated using regex patterns:</p>

                <pre>def validate_customer_id(customer_id: str) -> bool:
    """Validate customer ID format."""
    pattern = r'^CUST_[A-Z0-9]{8}$'
    return bool(re.match(pattern, customer_id))

def validate_date_string(date_str: str) -> str:
    """Validate date format (YYYY-MM-DD)."""
    if not re.match(r'^\d{4}-\d{2}-\d{2}$', date_str):
        raise ValueError("Invalid date format")
    datetime.strptime(date_str, '%Y-%m-%d')  # Verify valid date
    return date_str

def validate_segment_field(segment: str) -> str:
    """Whitelist segment fields."""
    valid = {'company_size', 'industry', 'channel'}
    if segment not in valid:
        raise ValueError(f"Invalid segment: {segment}")
    return segment</pre>

                <h3>7.2 Data Integrity Checks</h3>
                <p><strong>Business Logic Validation:</strong></p>
                <pre># MRR cannot be negative
assert mrr >= 0, "MRR must be non-negative"

# Churn date must be after start date
if churn_date:
    assert churn_date > start_date, "Invalid churn date"

# NPS score must be 0-10
assert 0 <= nps_score <= 10, "NPS must be 0-10"

# Conversion rate must be 0-1
assert 0 <= conversion_rate <= 1, "Invalid conversion rate"</pre>

                <h3>7.3 Outlier Detection</h3>
                <p><strong>Statistical Methods:</strong></p>
                <pre>def detect_outliers_iqr(data):
    """Detect outliers using IQR method."""
    Q1 = data.quantile(0.25)
    Q3 = data.quantile(0.75)
    IQR = Q3 - Q1

    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR

    return (data < lower_bound) | (data > upper_bound)</pre>

                <p><strong>Domain-Specific Rules:</strong></p>
                <ul>
                    <li>MRR > $100K flagged for review (potential enterprise)</li>
                    <li>Deal cycles > 365 days flagged as stale</li>
                    <li>Churn probability > 0.95 reviewed for model validity</li>
                </ul>
            </section>

            <section id="performance">
                <h2>8. Performance Optimization</h2>

                <h3>8.1 Query Optimization</h3>
                <p><strong>Index Strategy:</strong></p>
                <p>23 indexes created based on query patterns:</p>

                <pre>-- Frequent filters
CREATE INDEX idx_customers_status ON customers(status);
CREATE INDEX idx_customers_health ON customers(health_score);

-- Time-based queries
CREATE INDEX idx_customers_start ON customers(start_date);
CREATE INDEX idx_mrr_date ON mrr_movements(movement_date);

-- Compound indexes for multi-column filters
CREATE INDEX idx_customers_status_health ON customers(status, health_score);
CREATE INDEX idx_mrr_customer_date ON mrr_movements(customer_id, movement_date);</pre>

                <h3>8.2 Caching Strategy</h3>
                <p><strong>API Response Caching:</strong></p>
                <p>In-memory LRU cache with TTL:</p>

                <pre>from functools import lru_cache

@cached(ttl=60, key_prefix="summary")
async def get_executive_summary():
    """Cached for 60 seconds."""
    # Expensive calculations
    return results</pre>

                <h4>Cache Configuration</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>TTL (seconds)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Summary endpoint</td>
                            <td>60</td>
                        </tr>
                        <tr>
                            <td>Customer list</td>
                            <td>120</td>
                        </tr>
                        <tr>
                            <td>Health distribution</td>
                            <td>300</td>
                        </tr>
                        <tr>
                            <td>Revenue metrics</td>
                            <td>180</td>
                        </tr>
                    </tbody>
                </table>

                <h3>8.3 Parallel Processing</h3>
                <p><strong>Concurrent Query Execution:</strong></p>
                <pre>import asyncio

async def fetch_all_metrics():
    """Fetch metrics in parallel."""
    results = await asyncio.gather(
        get_revenue_summary(),
        get_churn_summary(),
        get_funnel_summary(),
        get_health_distribution()
    )
    return results</pre>

                <div class="callout callout-success">
                    <h4>Performance Benefits</h4>
                    <ul>
                        <li>4x faster dashboard load time</li>
                        <li>Reduced database connection time</li>
                        <li>Better resource utilization</li>
                    </ul>
                </div>
            </section>

            <section id="ai-insights">
                <h2>9. AI-Powered Insights</h2>

                <p>The platform integrates Claude AI (by Anthropic) to provide on-demand, context-aware analysis across every dashboard page. Rather than pre-computed static text, insights are generated in real-time using live data from the database, giving users actionable intelligence tailored to the current state of their business.</p>

                <div class="callout callout-info">
                    <h4>Architecture Overview</h4>
                    <ul>
                        <li><strong>AI Provider:</strong> Anthropic Claude API (claude-sonnet-4-20250514)</li>
                        <li><strong>Integration:</strong> Server-side Python via <code>anthropic</code> SDK</li>
                        <li><strong>Trigger:</strong> On-demand (user clicks "Generate Insights")</li>
                        <li><strong>Token Limit:</strong> 1,024 max tokens per response</li>
                        <li><strong>Shared Helper:</strong> Single <code>_call_claude()</code> function for all endpoints</li>
                    </ul>
                </div>

                <h3>9.1 API Endpoints</h3>
                <p>All AI endpoints are registered under the <code>/api/ai</code> prefix and accept POST requests. Each endpoint queries live data from the database and constructs a specialized prompt for Claude.</p>

                <table>
                    <thead>
                        <tr>
                            <th>Endpoint</th>
                            <th>Page</th>
                            <th>Data Sources</th>
                            <th>AI Focus</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>/api/ai/customer-insights</code></td>
                            <td>Customer Detail</td>
                            <td>customers, usage_events, nps_surveys, mrr_movements</td>
                            <td>Individual health &amp; risk analysis, intervention strategies</td>
                        </tr>
                        <tr>
                            <td><code>/api/ai/executive-insights</code></td>
                            <td>Executive Summary</td>
                            <td>revenue_summary, churn_summary, funnel_summary, health_distribution, action_priority_matrix</td>
                            <td>Monday morning briefing, anomalies, top 3 priorities</td>
                        </tr>
                        <tr>
                            <td><code>/api/ai/risk-insights</code></td>
                            <td>Revenue at Risk</td>
                            <td>churn_summary, at_risk_customers (top 10), revenue_leakage_analysis</td>
                            <td>Root-cause churn patterns, segment interventions, 90-day forecast</td>
                        </tr>
                        <tr>
                            <td><code>/api/ai/funnel-insights</code></td>
                            <td>Funnel Analysis</td>
                            <td>funnel_summary, stage_conversion_rates, velocity_metrics, loss_reasons, rep_performance (top 10)</td>
                            <td>Bottleneck identification, loss reason fixes, rep coaching</td>
                        </tr>
                        <tr>
                            <td><code>/api/ai/simulator-insights</code></td>
                            <td>What-If Simulator</td>
                            <td>revenue_summary, scenario presets</td>
                            <td>Highest-ROI scenarios, optimal parameters, monitoring guidance</td>
                        </tr>
                        <tr>
                            <td><code>/api/ai/revenue-insights</code></td>
                            <td>Revenue Intelligence</td>
                            <td>revenue_summary, mrr_waterfall, nrr_trend, ltv_cac_summary</td>
                            <td>Revenue trend narrative, MRR drivers, NRR health, 3-month forecast</td>
                        </tr>
                    </tbody>
                </table>

                <h3>9.2 Prompt Engineering</h3>
                <p>Each endpoint uses a specialized system prompt that establishes a domain-expert persona. The system dynamically selects between two prompt strategies based on user input:</p>

                <h4>Default Mode (No Custom Question)</h4>
                <p>The system prompt is highly specific to the page context with structured output instructions:</p>
                <pre>// Executive Summary example:
System: "Provide a Monday morning briefing. Focus on:
  1) Overall health narrative
  2) Key anomalies
  3) Top 3 priorities with expected impact
  4) One metric deserving deeper investigation.
  Use numbers."

User: [Full data context from database queries]</pre>

                <h4>Custom Question Mode</h4>
                <p>When the user provides a specific question, the system prompt becomes a flexible domain expert:</p>
                <pre>// Executive Summary example:
System: "You are an expert SaaS business strategist.
  Answer using provided data.
  Be concise, data-driven, actionable."

User: [Data context + user's specific question]</pre>

                <h4>System Roles by Page</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Page</th>
                            <th>AI Role</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Customer Detail</td>
                            <td>Expert SaaS Customer Success analyst</td>
                        </tr>
                        <tr>
                            <td>Executive Summary</td>
                            <td>Expert SaaS business strategist</td>
                        </tr>
                        <tr>
                            <td>Revenue at Risk</td>
                            <td>Expert SaaS retention strategist</td>
                        </tr>
                        <tr>
                            <td>Funnel Analysis</td>
                            <td>Expert SaaS sales operations analyst</td>
                        </tr>
                        <tr>
                            <td>What-If Simulator</td>
                            <td>Expert SaaS revenue strategist</td>
                        </tr>
                        <tr>
                            <td>Revenue Intelligence</td>
                            <td>Expert SaaS revenue analyst</td>
                        </tr>
                    </tbody>
                </table>

                <h3>9.3 Backend Implementation</h3>
                <p><strong>Location:</strong> <code>backend/api/routes/ai_insights.py</code></p>

                <h4>Shared Helpers</h4>
                <pre>_get_api_key()      # Retrieves ANTHROPIC_API_KEY from environment
_call_claude()      # Core API wrapper: system prompt + user message â†’ insight + model name
_format_dict()      # JSON formatter for context data in prompts
get_health_category()  # Maps health_score (0-100) to Green/Yellow/Red
get_nps_category()     # Maps NPS score to Promoter/Passive/Detractor</pre>

                <h4>Model Configuration</h4>
                <pre>from anthropic import Anthropic

client = Anthropic(api_key=api_key)
response = client.messages.create(
    model="claude-sonnet-4-20250514",
    max_tokens=1024,
    system=system_prompt,
    messages=[{"role": "user", "content": user_message}]
)</pre>

                <h3>9.4 Frontend Components</h3>
                <p><strong>Location:</strong> <code>frontend/components/ai/</code></p>

                <h4>PageInsights (Reusable)</h4>
                <p>A shared component used on 5 dashboard pages (Executive, Revenue, Risk, Funnel, Simulator):</p>
                <ul>
                    <li>Collapsible card UI with expand/collapse toggle</li>
                    <li>"Generate Insights" button for default analysis</li>
                    <li>Custom question textarea with Enter-to-send support</li>
                    <li>Suggested questions displayed as clickable buttons</li>
                    <li>Loading spinner during API calls</li>
                    <li>Result display with model name attribution</li>
                    <li>Clear and Regenerate controls</li>
                </ul>

                <pre>// Props interface
interface PageInsightsProps {
  pageId: string;           // e.g. "executive", "revenue"
  pageTitle: string;        // Display name
  apiEndpoint: string;      // e.g. "/api/ai/executive-insights"
  buttonLabel?: string;     // e.g. "Generate Executive Briefing"
  suggestedQuestions: string[];
  contextData?: Record&lt;string, any&gt;;
}</pre>

                <h4>CustomerInsights (Dedicated)</h4>
                <p>A dedicated component for individual customer analysis on the Customer Detail page:</p>
                <ul>
                    <li>Accepts <code>customerId</code> and <code>customerName</code> props</li>
                    <li>Hardcoded suggested questions (e.g., "Why is this customer at risk?")</li>
                    <li>Calls <code>/api/ai/customer-insights</code> endpoint</li>
                </ul>

                <h3>9.5 Configuration</h3>
                <div class="callout callout-warning">
                    <h4>Required Environment Variable</h4>
                    <p>The AI insights feature requires an <code>ANTHROPIC_API_KEY</code> environment variable. Without it, all <code>/api/ai/*</code> endpoints return HTTP 500. Set it in the backend <code>.env</code> file:</p>
                    <pre>ANTHROPIC_API_KEY=your_api_key_here</pre>
                    <p><strong>Dependency:</strong> <code>anthropic>=0.18.0</code> (Python SDK)</p>
                </div>
            </section>

            <section id="appendix">
                <h2>Appendix A: Glossary</h2>

                <table>
                    <thead>
                        <tr>
                            <th>Term</th>
                            <th>Definition</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ARR</strong></td>
                            <td>Annual Recurring Revenue - Normalized annual value of recurring subscriptions</td>
                        </tr>
                        <tr>
                            <td><strong>MRR</strong></td>
                            <td>Monthly Recurring Revenue - Predictable monthly subscription revenue</td>
                        </tr>
                        <tr>
                            <td><strong>NRR</strong></td>
                            <td>Net Revenue Retention - Revenue retention rate including expansion and churn</td>
                        </tr>
                        <tr>
                            <td><strong>CAC</strong></td>
                            <td>Customer Acquisition Cost - Fully-loaded cost to acquire a new customer</td>
                        </tr>
                        <tr>
                            <td><strong>LTV</strong></td>
                            <td>Lifetime Value - Present value of future cash flows from a customer</td>
                        </tr>
                        <tr>
                            <td><strong>NPS</strong></td>
                            <td>Net Promoter Score - Customer satisfaction metric on 0-10 scale</td>
                        </tr>
                        <tr>
                            <td><strong>ARPA</strong></td>
                            <td>Average Revenue Per Account - Mean MRR across all customers</td>
                        </tr>
                    </tbody>
                </table>

                <h2>Appendix B: References</h2>

                <h3>Industry Benchmarks</h3>
                <ul>
                    <li>KeyBanc Capital Markets SaaS Survey</li>
                    <li>OpenView SaaS Benchmarks</li>
                    <li>SaaStr Annual Reports</li>
                    <li>ChartMogul SaaS Metrics Reports</li>
                </ul>

                <h3>Statistical Methods</h3>
                <ul>
                    <li>"Applied Predictive Modeling" - Kuhn & Johnson</li>
                    <li>"An Introduction to Statistical Learning" - James et al.</li>
                    <li>SciPy Documentation: scipy.stats</li>
                </ul>

                <h3>Machine Learning</h3>
                <ul>
                    <li>XGBoost Documentation</li>
                    <li>SHAP (SHapley Additive exPlanations) Library</li>
                    <li>scikit-learn User Guide</li>
                </ul>

                <h2>Appendix C: Technology Stack</h2>

                <h3>Backend</h3>
                <ul>
                    <li>Python 3.11+</li>
                    <li>FastAPI (API framework)</li>
                    <li>DuckDB 0.9+ (analytical database)</li>
                    <li>Pandas 2.1+ (data manipulation)</li>
                    <li>NumPy 1.26+ (numerical computing)</li>
                    <li>scikit-learn 1.4+ (machine learning)</li>
                    <li>XGBoost 2.0+ (gradient boosting)</li>
                    <li>SHAP 0.44+ (model interpretability)</li>
                    <li>Anthropic SDK 0.18+ (Claude AI integration)</li>
                </ul>

                <h3>Frontend</h3>
                <ul>
                    <li>Next.js 14 (React framework)</li>
                    <li>TypeScript 5.3+ (type safety)</li>
                    <li>TailwindCSS (styling)</li>
                </ul>

                <hr style="margin: 3rem 0; border: none; border-top: 2px solid var(--border);">

                <div style="text-align: center; color: var(--text-secondary); padding: 2rem 0;">
                    <p><strong>Author:</strong> SaaS Revenue Lifecycle Analyzer Development Team</p>
                    <p><strong>Version:</strong> 1.0 | <strong>Date:</strong> January 27, 2026</p>
                    <p><strong>Status:</strong> Production | <strong>Next Review:</strong> April 2026</p>
                    <p style="margin-top: 2rem;">For questions or updates to this methodology, please contact the development team.</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        // Smooth scrolling for navigation links
        document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Highlight active section in navigation
        window.addEventListener('scroll', () => {
            let current = '';
            const sections = document.querySelectorAll('section');

            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                if (pageYOffset >= sectionTop - 100) {
                    current = section.getAttribute('id');
                }
            });

            document.querySelectorAll('nav a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === `#${current}`) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>
